<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../owc-core-window-manager/owc-core-navigation-panel.html">
<script src="../underscore/underscore-min.js"></script>
<dom-module id="owc-core-window-manager">
    <template>
        <style>
          :host{
              position:absolute;
              width: 100%;
              height: 100%;

          }
          .owc-core-window-manager-viewport{
            position: absolute;
            width: 100%;
            height: 100%;
            overflow-x: var(--owc-core-window-manager-viewport-overflow, auto);
            background-image: var(--owc-core-window-manager-background-image);
              background: #91A9D2;
            /*overflow-y: hidden;*/
            overflow-x: auto !important;

          }

          #panels-container{
            position:relative;
            height: 100%;
            width:100%;
            overflow-y: auto;
          }

          .owc-core-window-manager-container{

          }

        </style>

        <div id="{{_viewportId}}" class="owc-core-window-manager-viewport">
          <div id="panels-container">
          </div>
        </div>
    </template>
    <script>

      class OwcCoreWindowManager extends Polymer.Element {

          static get is() { return 'owc-core-window-manager'; }

          static get properties() {
              return {
                  counter: { type: Number, value: 0, notify: true },
                  _navigationStack:{ type: Array, value: [] },
                  _containerView:{ type: Object, value: {} },
                  _ctx:{ type: Object, value: {} },
                  _viewportId: { type: String,
                    value: "owc-core-window-manager-viewport"},
                  _containerId: { type: String,
                    value: "owc-core-window-manager-container" },
                  _theme: { type: Object, observer: "_themeChanged",
                    value: {backgroundUrl:"", backgroundColor:"" } }
              };
          }

          connectedCallback() {
            super.connectedCallback();
            this._theme = { backgroundUrl: "url", backgroundColor: "color" };
            this.manageEscButton();
          }

          disconnectedCallback() {
            super.disconnectedCallback();
          }

          _createPanel(ctx){
            return new OwcCoreNavigationPanel(ctx);
          }

          popComponent() {
            var viewport = this.shadowRoot.querySelector("#panels-container");
            viewport.lastChild.del();
          }

          _themeChanged(newVal, oldVal) {

          }

          pushComponent(component){
              component._ctx = this._ctx;
              let new_panel = this._createPanel(this._ctx);
              this._appendPanel(new_panel);
              new_panel.embedComponent(component);
              console.log("this.shadowRoot.querySelector('.panels-container')", this.shadowRoot.querySelector('.panels-container'));
          }

          _appendPanel(panel){
            this.shadowRoot.querySelector("#panels-container").appendChild(panel);
          }

          manageEscButton() {
              var self = this,
                  ESC_BUTTON_CODE = 27;
              document.addEventListener('keyup', function(e) {
                  if (e.keyCode == ESC_BUTTON_CODE) {
                      self.popComponent();
                      console.log("ESC");
                  }
              });
          }

      }

      window.customElements.define(OwcCoreWindowManager.is, OwcCoreWindowManager);

    </script>
</dom-module>
